<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventario</title>
  <link rel="stylesheet" href="/estilos.css" />
</head>
<body>
    <main style="padding: 2rem; max-width: 2000px; margin:auto;"></main>
  <div class="nav">
     <a href="/catalogo">CatÃ¡logo</a>
    <a href="/entradas">Entradas</a>
    <a href="/inventario" class="active">Inventario</a>
    <a href="/salidas">Salidas</a>
    <a href="/clientes">Clientes</a>
    <a href="/cotizaciones">Cotizaciones</a>


    <% if (usuario && usuario.tipo_usuario==='administrador' ) { %>
      <a href="/usuarios">Usuarios</a> <!-- Solo visible para administradores -->
      <% } %>

  </div>
  <main class="contenedor" style="padding: 2rem; max-width: 2000px; margin:auto;">

    <div style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
      <a href="/reporte" target="_blank">
        <button class="btn btn3">ðŸ“„ Compartir Inventario</button>
      </a>
    </div>

    <h2>Inventario Actual</h2>

    <table>
      <thead>
        <tr>
          <th>Producto</th>
          <th>Lote</th>
          <th>Stock</th>
          <th>Caducidad</th>
          <th>DÃ­as Restantes</th>
          <th>Estado</th>
        </tr>
      </thead>

      <tbody>
        <% inventario.forEach(i => { %>
          <tr>
            <td><%= i.ProductoNombre %></td>
            <td><%= i.lote_inventario %></td>
            <td><%= i.stock_inventario %></td>

            <!-- Fecha formateada de forma segura -->
            <td>
              <% if (i.caducidad_inventario) { %>
                <%= new Date(i.caducidad_inventario).toLocaleDateString('es-MX', {
                  day: '2-digit',
                  month: '2-digit',
                  year: 'numeric'
                }) %>
              <% } else { %>
                -
              <% } %>
            </td>

            <td><%= (i.diasRestantes_inventario ?? i.DiasRestantes ?? '-') %> <%= (i.diasRestantes_inventario ?? i.DiasRestantes) != null ? 'dÃ­as' : '' %></td>


            <td class="<%= 
              i.estadoDelProducto_inventario === 'Vigente' ? 'estado-verde' :
              i.estadoDelProducto_inventario === 'PrÃ³ximo a vencer' ? 'estado-amarillo' :
              'estado-rojo' %>">
              <%= i.estadoDelProducto_inventario %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </main>

  <form action="/logout" method="get">
    <a href="/logout" class="btn-logout">Cerrar sesiÃ³n</a>
  </form>
</body>
</html>